<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: head}">

  <title>TV Series</title>
</head>
<body>

<div th:if="${@currentUser.isLogged() and @currentUser.isAdmin()}">
  <div th:replace="~{fragments/adminNavigation :: adminNavigation}"></div>
</div>
<div th:unless="${@currentUser.isLogged() and @currentUser.isAdmin()}">
  <div th:replace="~{fragments/navigation :: navigation}"></div>
</div>

<div class="container">
  <div class="blur-background" th:style="'background-image: url(/uploads/' + ${seriesById.imageURL} + ')'"></div>
  <div class="movie-info">
    <h1 th:text="${seriesById.title}"></h1>
    <div class="movie-content">
      <div class="movie-img">
        <img th:src="@{'/uploads/' + ${seriesById.imageURL}}" style="height: 400px; width: 300px"  alt="Image">
      </div>
      <div class="movie-video">
        <iframe width="700" height="400" th:src="@{'https://www.youtube.com/embed/' + ${seriesById.videoURL}}" allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <div class="movie-detail full-width">
    <div class="movie-main-info">
      <div class="categories-container">
        <div th:each="c : ${seriesById.category}">
            <a class="button-6" th:href="@{'/categories/' + ${c.id}}" th:text="${c.categoryName}"></a>
            <div th:if="${@currentUser.isAdmin()}">
              <form th:action="@{'/series/remove-category/' + ${seriesById.id} + '/' + ${c.id}}" method="post" style="display:inline;">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
            </div>
        </div>
        <div class="watchlist-btn">
          <form th:action="@{'/series/add/' + ${seriesById.id}}" method="post" th:if="${@currentUser.isLogged()} and not ${@currentUser.isAdmin()}">
            <button type="submit" class="add-to-watchlist-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bookmark-plus bell" viewBox="0 0 16 16">
                <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1z"/>
                <path d="M8 4a.5.5 0 0 1 .5.5V6H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V7H6a.5.5 0 0 1 0-1h1.5V4.5A.5.5 0 0 1 8 4"/>
              </svg>
              Add to Series Watchlist
              <div class="arrow">›</div>
            </button>
          </form>
          <form action="/users/login" method="get" th:unless="${@currentUser.isLogged()}">
            <button type="submit" class="add-to-watchlist-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bookmark-plus bell" viewBox="0 0 16 16">
                <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1z"/>
                <path d="M8 4a.5.5 0 0 1 .5.5V6H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V7H6a.5.5 0 0 1 0-1h1.5V4.5A.5.5 0 0 1 8 4"/>
              </svg>
              Add to Series Watchlist
              <div class="arrow">›</div>
            </button>
          </form>
          <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
          <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
        </div>
      </div>

      <p th:text="${seriesById.description}"></p>
      <hr>
      <p><b>Year </b><a th:href="@{'/movies/year/' + ${releaseYear}}" th:text="${releaseYear}"></a></p>
      <hr>
      <p><b>Director </b><a th:href="@{'/directors/' + ${seriesById.getDirector().id}}" th:text="${seriesById.getDirector().directorName}"></a></p>
      <hr>
      <p><b>Rating</b> <span th:text="${seriesById.rating}"></span> / 10</p>
      <p th:if="${@currentUser.isLogged() and not @currentUser.isAdmin() and averageRating != null and averageRating != 0.0}">Average Rating: <span th:text="${averageRating}"></span></p>
      <p th:if="${@currentUser.isLogged() and not @currentUser.isAdmin() and userRating != null and userRating != 0}">Your Rating: <span th:text="${userRating}"></span></p>

      <div class="rate-button">
        <div class="button-wrapper">
          <div class="rate-text">Rate</div>
            <span class="icon">
              <a th:if="${@currentUser.isLogged()} and not ${@currentUser.isAdmin()}" data-toggle="modal" data-target="#ratingModal">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                  <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z"/>
                </svg>
              </a>

              <a th:href="@{/users/login}" th:unless="${@currentUser.isLogged()}" style="text-decoration: none">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                  <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z"/>
                </svg>
              </a>
            </span>
        </div>
      </div>
      <hr>
      <h3>Top Cast  </h3>
      <div class="actors-container">
        <div class="actor" th:each="a : ${seriesById.actors}">
          <a th:href="@{'/actors/' + ${a.id}}">
            <img th:src="@{'/uploads/' + ${a.actorImg}}" class="actor-img-movie">
            <span class="actor-name" th:text="${a.actorName}"></span>
          </a>
          <div th:if="${@currentUser.isAdmin()}">
            <form th:action="@{'/series/remove-actor/' + ${seriesById.id} + '/' + ${a.id}}" method="post" style="display:inline;">
              <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
          </div>
        </div>
      </div>

      <button type="button" class="btn btn-primary" th:if="${@currentUser.isLogged()} and ${@currentUser.isAdmin()}" data-toggle="modal" data-target="#updateModal">Update Information</button>
      <button type="button" class="btn btn-primary" th:if="${@currentUser.isLogged()} and ${@currentUser.isAdmin()}"  th:data-movie-id="${seriesById.id}"  data-toggle="modal" data-target="#addActorModal">Add Actors</button>
      <button type="button" class="btn btn-primary" th:if="${@currentUser.isLogged()} and ${@currentUser.isAdmin()}"  th:data-movie-id="${seriesById.id}"  data-toggle="modal" data-target="#addCategoryModal">Add Category</button>

      <form th:if="${@currentUser.isLogged()} and ${@currentUser.isAdmin()}" th:action="@{'/series/delete/' + ${seriesById.id}}" method="post" onsubmit="return confirm('Are you sure you want to delete this TV Series?');">
        <button type="submit" class="btn btn-danger">Delete TV Series</button>
      </form>
    </div>
    <div class="container-similar">
    <div th:if="${not #lists.isEmpty(similarSeries)}">
      <h2>Similar TV Series</h2>
      <div class="row">
        <div class="col-md-2 mb-4" th:each="s : ${similarSeries}">
          <div class="card">
            <a  th:src="@{'/uploads/' + ${s.imageURL}}">
              <img  th:src="@{'/uploads/' + ${s.imageURL}}" class="card-img-top" alt="Movie Image">
            </a>
            <div class="card-body">
              <p class="card-text">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#ff6600" class="bi bi-star-fill" viewBox="0 0 16 16">
                  <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                </svg>
                <span class="rating-text" th:text="${s.rating}"></span>
              </p>
              <h5 class="card-title" th:text="${s.title}"></h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
</div>

<div class="modal fade" id="ratingModal" tabindex="-1" aria-labelledby="ratingModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ratingModalLabel">Rate Movie</h5>
      </div>
      <div class="modal-body">
        <div class="rating-container">
          <form id="rating-form" th:action="@{'/series/rateSeries/' + ${seriesById.id}}" method="post">
            <input type="radio" id="rating-1" name="rating" value="1">
            <label for="rating-1">1</label>

            <input type="radio" id="rating-2" name="rating" value="2">
            <label for="rating-2">2</label>

            <input type="radio" id="rating-3" name="rating" value="3">
            <label for="rating-3">3</label>

            <input type="radio" id="rating-4" name="rating" value="4">
            <label for="rating-4">4</label>

            <input type="radio" id="rating-5" name="rating" value="5">
            <label for="rating-5">5</label>

            <input type="radio" id="rating-6" name="rating" value="6">
            <label for="rating-6">6</label>

            <input type="radio" id="rating-7" name="rating" value="7">
            <label for="rating-7">7</label>

            <input type="radio" id="rating-8" name="rating" value="8">
            <label for="rating-8">8</label>

            <input type="radio" id="rating-9" name="rating" value="9">
            <label for="rating-9">9</label>

            <input type="radio" id="rating-10" name="rating" value="10">
            <label for="rating-10">10</label>

            <button type="submit" class="btn text-white">Rate</button>
          </form>

<!--          <form id="delete-rating-form" th:action="@{'/series/delete-series-rating/' + ${seriesById.id}}" method="post">-->
<!--            <button type="submit" class="btn text-white">Delete Rating</button>-->
<!--          </form>-->
        </div>
      </div>
    </div>
  </div>
</div>
<div id="updateModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Update Series Information</h5>
      </div>
      <div class="modal-body">
        <form th:action="@{'/series/update/'  + ${seriesById.id} }" method="post" enctype="multipart/form-data">
          <input type="hidden" id="id" name="id" th:value="${seriesById.id}">

          <label for="title">Title:</label><br>
          <input type="text" id="title" name="title" th:value="${seriesById.title}"><br>

          <label for="releaseDate">Release Date:</label><br>
          <input type="date" id="releaseDate" name="releaseDate" th:value="${seriesById.releaseDate}"><br>

          <label for="releaseDate">Seasons:</label><br>
          <input type="text" id="seasons" name="seasons" th:value="${seriesById.seasons}"><br>

          <label for="rating">Rating:</label><br>
          <input type="number" id="rating" name="rating" min="1" max="10" step="0.1" th:value="${seriesById.rating}"><br>

<!--          <label for="imageURL">Image URL:</label><br>-->
<!--          <input type="text" id="imageURL" name="imageURL" th:value="${seriesById.imageURL}"><br>-->

          <label for="file">Image:</label><br>
          <input type="file" id="file" name="file" />

          <label for="videoURL">Video URL:</label><br>
          <input type="text" id="videoURL" name="videoURL" th:value="${seriesById.videoURL}"><br>

          <label for="description">Description:</label><br>
          <textarea id="description" name="description" th:text="${seriesById.description}"></textarea><br>

          <label for="director">Director: </label>-->
          <select id="director" name="directorId" class="form-control" required>
            <option th:each="director : ${allDirectors}" th:value="${director.id}"
                    th:text="${director.directorName}"
                    th:selected="${director.id} == ${seriesById.director.id}">
            </option>
          </select>
          <input type="submit" value="Update">
        </form>
      </div>
    </div>
  </div>
</div>
<div id="addActorModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Actors</h5>
      </div>
      <div class="modal-body">
        <form th:action="@{/series/add-actors}" method="post">
          <label for="actorName">Actor Name</label>
          <input type="text" class="form-control" id="actorName" name="actorName" required>

          <input type="hidden" th:value="${seriesById.id}" name="seriesId">

          <input type="submit" value="Add Actor">
        </form>
      </div>
    </div>
  </div>
</div>
<div id="addCategoryModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Category</h5>
      </div>
      <div class="modal-body">
        <form th:action="@{/series/add-category}" method="post">
          <label for="categoryName">Category</label>
          <input type="text" class="form-control" id="categoryName" name="categoryName" required>

          <input type="hidden" th:value="${seriesById.id}" name="seriesId">

          <input type="submit" value="Add Category">
        </form>
      </div>
    </div>
  </div>
</div>
<div>
  <footer th:replace="~{fragments/footer :: footer}"></footer>
</div>
</body>
</html>